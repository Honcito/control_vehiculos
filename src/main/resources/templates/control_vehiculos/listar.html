<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{plantilla/template_user :: head}">
    <meta charset="UTF-8">
    <title>Control de Entrada/Salida de Vehículos</title>
    <link rel="stylesheet" th:href="@{/static/css/tablas.css}"/>
    <script th:src="@{/static/js/interactiveTable.js}"></script>
    <script src="https://code.jquery.com/jquery-3.6.9.min.js"></script>
  <style>
    .table th {
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .table td {
      vertical-align: middle;
    }
    .btn-group {
      display: flex;
      align-items: center;
    }
    .btn-group .btn {
      margin-right: 5px;
    }
  </style>
</head>
<body>
<header th:replace="~{plantilla/template_user :: header}"></header>
<div class="container">
  <h1 class="mt-3" th:text="${titulo}">Control de Entrada/Salida de Vehículos</h1>

  <table class="table">
    <thead class="thead-dark">
    <tr>
      <th scope="col">MATRÍCULA</th>
      <th scope="col">EMPRESA</th>
      <th scope="col">FECHA/HORA SALIDA</th>
      <th scope="col">OBSERVACIONES</th>
      <th scope="col">FECHA/HORA ENTRADA</th>
      <th scope="col">ACCIONES</th>
    </tr>
    </thead>
      <tbody id="control_vehiculos-tbody">
      <tr th:each="controlVehiculo, rowStat : ${listadoControles}" th:index="${rowStat.index}">
          <td>
              <input type="text" class="matricula-input" th:value="${controlVehiculo.matricula}" th:attr="data-row-index=${rowStat.index}">
              <span class="error" style="color: red; display: none;">Matrícula no encontrada</span>
              <input type="hidden" class="cod-vehiculo" th:value="${controlVehiculo.cod_vehiculo}">
          </td>
          <td>
              <input type="text" class="empresa-input" th:value="${controlVehiculo.empresa}">
          </td>
          <td contenteditable="true" th:attr="data-id=${controlVehiculo.cod_control}" class="fecha-salida" th:text="${controlVehiculo.getFechaSalidaFormateada()}"></td>
          <td contenteditable="true" th:attr="data-id=${controlVehiculo.cod_control}" class="observaciones" th:text="${controlVehiculo.observaciones}"></td>
          <td contenteditable="true" th:attr="data-id=${controlVehiculo.cod_control}" class="fecha-entrada" th:text="${controlVehiculo.getFechaEntradaFormateada()}"></td>
          <td>
              <div class="btn-group">
                  <button onclick="actualizarFila(this)" class="btn btn-primary">Actualizar</button>
                  <button onclick="eliminarFila(this)" class="btn btn-danger">Eliminar</button>
              </div>
          </td>
      </tr>
      <!-- New row template for adding new entries -->
      <tr id="new-row">
          <td>
              <input type="text" class="matricula-input" data-row-index="new">
              <span class="error" style="color: red; display: none;">Matrícula no encontrada</span>
              <input type="hidden" class="cod-vehiculo">
          </td>
          <td>
              <input type="text" class="empresa-input">
          </td>
          <td contenteditable="true" class="new-control fecha-salida"></td>
          <td contenteditable="true" class="new-control observaciones"></td>
          <td contenteditable="true" class="new-control fecha-entrada"></td>
          <td>
              <div class="btn-group">
                  <button onclick="guardarFila(this)" class="btn btn-primary">Guardar</button>
                  <button onclick="eliminarFila(this)" class="btn btn-danger">Eliminar</button>
              </div>
          </td>
      </tr>
      </tbody>
  </table>
</div>
</body>
</html>